---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Container from "@/components/container.astro";
import Sectionhead from "@/components/sectionhead.astro";
import FounderCard from "@/components/founder-card.astro";
import { getLangFromUrl, t } from "@/utils/i18n";

const lang = getLangFromUrl(Astro.url);

// Get the company story (filtered by language)
const aboutEntries = await getCollection("about", ({ data }) => {
  return data.lang === lang;
});
const companyStory = aboutEntries.find((entry) => entry.slug.includes("company-story"));
const { Content } = companyStory ? await companyStory.render() : { Content: null };

// Get founders sorted by order (filtered by language)
const founders = (await getCollection("founders", ({ data }) => {
  return !data.draft && data.publishDate < new Date() && data.lang === lang;
})).sort((a, b) => a.data.order - b.data.order);
---

<Layout title={t(lang, "about.title")}>
  <Container>
    <Sectionhead>
      <Fragment slot="title">{t(lang, "about.title")}</Fragment>
      <Fragment slot="desc">{t(lang, "about.subtitle")}</Fragment>
    </Sectionhead>

    {/* Company Story */}
    {Content && (
      <div class="prose prose-lg max-w-4xl mx-auto mt-16">
        <Content />
      </div>
    )}

    {/* Founders Section */}
    <div class="mt-24 mb-12">
      <h2 class="text-4xl font-bold text-center text-[#333333] mb-16">
        {t(lang, "about.foundersTitle")}
      </h2>
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8 max-w-7xl mx-auto">
        {founders.map((founder) => (
          <FounderCard
            name={founder.data.name}
            role={founder.data.role}
            bio={founder.data.bio}
            avatarSeed={founder.data.avatar.seed}
            avatarStyle={founder.data.avatar.style}
          />
        ))}
      </div>
    </div>
  </Container>
</Layout>
